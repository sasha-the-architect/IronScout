# IronScout Local Development Proxy
#
# Provides HTTPS domain aliases for local development.
# Uses *.local.ironscout.ai which resolves to 127.0.0.1 via DNS.
#
# DNS Setup (one-time):
#   Add A record: *.local.ironscout.ai â†’ 127.0.0.1
#
# Usage:
#   1. Start apps: pnpm dev:all (or node scripts/dev/start-all.mjs)
#   2. Start proxy: caddy run
#
# Then access:
#   https://www.local.ironscout.ai     - Marketing site
#   https://app.local.ironscout.ai     - Main web app
#   https://api.local.ironscout.ai     - API server
#   https://admin.local.ironscout.ai   - Admin portal
#   https://merchant.local.ironscout.ai - Merchant portal

# Marketing site (www)
www.local.ironscout.ai {
	tls internal
	reverse_proxy 127.0.0.1:3004
}

# Main web application
app.local.ironscout.ai {
	tls internal
	reverse_proxy 127.0.0.1:3000
}

# API server
api.local.ironscout.ai {
	tls internal
	reverse_proxy 127.0.0.1:8000 {
		# Pass original host for CORS
		header_up Host {host}
		header_up X-Real-IP {remote_host}
		header_up X-Forwarded-For {remote_host}
		header_up X-Forwarded-Proto {scheme}
	}
}

# Admin portal
admin.local.ironscout.ai {
	tls internal
	reverse_proxy 127.0.0.1:3002
}

# Merchant portal
merchant.local.ironscout.ai {
	tls internal
	reverse_proxy 127.0.0.1:3003
}
